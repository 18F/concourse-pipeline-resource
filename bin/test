#!/bin/bash

set -eu

PASSWORD="${PASSWORD:?"PASSWORD must be provided"}"

set -x

TARGET="${TARGET:?"TARGET must be provided"}"
USERNAME="${USERNAME:?"USERNAME must be provided"}"
FLY_LOCATION="${FLY_LOCATION:?"FLY_LOCATION must be provided"}"

my_dir="$( cd "$( dirname "${0}" )" && pwd )"
base_dir="$( cd "${my_dir}/.." && pwd )"

pushd "${base_dir}" > /dev/null
  CGO_ENABLED=1 ginkgo \
    -r \
    -race \
    -nodes 4 \ # do not be greepy; it is counterproductive
    -randomizeAllSpecs \
    -randomizeSuites \
    "$@"
popd > /dev/null
